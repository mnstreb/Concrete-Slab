<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SlabMaster Pro | Concrete Estimator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f6;
        }
        .card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            padding: 1.5rem;
            height: 100%;
        }
        .input-group {
            margin-bottom: 1rem;
        }
        .input-group label {
            display: flex;
            align-items: center;
            font-weight: 700;
            color: #374151;
            margin-bottom: 0.4rem;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 0.6rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.5rem;
            transition: all 0.2s;
            background-color: white;
            font-size: 0.9rem;
        }
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .input-adornment {
            position: relative;
            width: 100%;
        }
        .input-adornment span {
            position: absolute;
            right: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9CA3AF;
            font-size: 0.7rem;
            font-weight: 800;
            pointer-events: none;
        }

        /* Tooltip & Info Icon Styles */
        .info-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background-color: #9CA3AF;
            color: white;
            text-align: center;
            font-size: 9px;
            font-weight: 800;
            cursor: help;
            margin-left: 6px;
            transition: background-color 0.2s;
        }
        .info-icon:hover { background-color: #64748b; }
        .tooltip { position: relative; display: inline-flex; align-items: center; }
        .tooltip .tooltip-content {
            visibility: hidden;
            width: 240px;
            background-color: #1e293b;
            color: #f8fafc;
            padding: 0.75rem;
            border-radius: 0.5rem;
            position: absolute;
            z-index: 100;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.2s;
            font-size: 0.7rem;
            line-height: 1.4;
            pointer-events: none;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
            text-transform: none;
            letter-spacing: normal;
            font-weight: 400;
        }
        .tooltip .tooltip-content::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1e293b transparent transparent transparent;
        }
        .tooltip:hover .tooltip-content { visibility: visible; opacity: 1; }

        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: #3b82f6; cursor: pointer; margin-top: -6px; box-shadow: 0 1px 3px rgba(0,0,0,0.2); border: 2px solid white; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 6px; background: #e5e7eb; border-radius: 3px; }

        input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; }
        details summary::-webkit-details-marker { display: none; }
        details summary { list-style: none; outline: none; }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-[1400px] mx-auto">
        <header class="mb-8 flex flex-col md:flex-row md:items-end justify-between gap-4 border-b pb-4">
            <div>
                <h1 class="text-3xl font-black text-slate-900 tracking-tight">SlabMaster <span class="text-blue-600">Pro</span></h1>
                <p class="text-slate-500 font-semibold uppercase text-xs tracking-widest">Executive SoCal Estimator â€¢ 2025</p>
            </div>
        </header>

        <!-- TOP ROW: CONFIGURATORS -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            
            <!-- STEP 1: DIMENSIONS -->
            <div class="card border-t-4 border-blue-500">
                <h2 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-6 border-b pb-2">1. Slab Dimensions</h2>
                <div class="space-y-4">
                    <div class="input-group">
                        <label>Length <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Factors in Site Layout & Staking labor at 0.05 HR/LF.</span></span></label>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="input-adornment"><input type="number" id="lengthFt" value="20" oninput="calculate()"><span>ft</span></div>
                            <div class="input-adornment"><input type="number" id="lengthIn" value="0" oninput="calculate()"><span>in</span></div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Width <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Factors in Site Layout & Staking labor at 0.05 HR/LF.</span></span></label>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="input-adornment"><input type="number" id="widthFt" value="10" oninput="calculate()"><span>ft</span></div>
                            <div class="input-adornment"><input type="number" id="widthIn" value="0" oninput="calculate()"><span>in</span></div>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="input-group">
                            <label>Slab Thick. <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Directly impacts Concrete CY volume and Placement labor (0.75 HR/CY).</span></span></label>
                            <div class="input-adornment"><input type="number" id="thickness" value="4" oninput="calculate()"><span>in</span></div>
                        </div>
                        <div class="input-group">
                            <label>Base Depth <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Factors in Gravel Base & Tamp labor at 0.03 HR/SF. 4" is the SoCal standard.</span></span></label>
                            <div class="input-adornment"><input type="number" id="baseThickness" value="4" oninput="calculate()"><span>in</span></div>
                        </div>
                    </div>
                    <div class="input-group pt-2 border-t border-slate-50">
                        <label class="text-blue-600 font-bold">Above Grade Exposure <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Reduces Excavation depth but ensures Formwork labor is calculated at full height (0.20 HR/LF).</span></span></label>
                        <div class="input-adornment"><input type="number" id="aboveGrade" value="0" oninput="calculate()" class="border-blue-100"><span>in</span></div>
                    </div>
                    <div class="p-3 bg-blue-50 rounded-lg border border-blue-100 flex justify-between items-center mt-2">
                        <p class="text-[10px] font-black text-blue-400 uppercase tracking-widest flex items-center">
                            Net Dig Depth 
                            <span class="tooltip ml-1"><span class="info-icon !bg-blue-300">i</span><span class="tooltip-content">Calculated as (Slab + Base) - Exposure. Drives Manual Excavation labor at 0.05 HR/SF.</span></span>
                        </p>
                        <p id="excavationHelperValue" class="text-xl font-black text-blue-700 italic">--</p>
                    </div>
                </div>
            </div>

            <!-- STEP 2: MATERIAL CONFIG -->
            <div class="card border-t-4 border-green-500">
                <h2 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-6 border-b pb-2">2. Material & Spec</h2>
                <div class="space-y-6">
                    <div class="bg-gray-50 p-3 rounded-lg border border-gray-100">
                        <div class="grid grid-cols-2 gap-3">
                            <div class="input-group mb-0"><label>Bar Size <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Rebar Setup labor factored at 0.02 HR/SF for residential grids.</span></span></label><select id="rebarSize" onchange="calculate()"><option value="#3">#3 (3/8")</option><option value="#4" selected>#4 (1/2")</option><option value="#5">#5 (5/8")</option></select></div>
                            <div class="input-group mb-0"><label>Spacing <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">18" OC is standard. 12" OC increases material cost but assumes same 0.02 HR/SF labor.</span></span></label><select id="rebarSpacing" onchange="calculate()"><option value="12">12" OC</option><option value="18" selected>18" OC</option><option value="24">24" OC</option></select></div>
                        </div>
                    </div>
                    <div>
                        <div class="grid grid-cols-2 gap-3 mb-3">
                            <div class="input-group mb-0">
                                <label>Target PSI <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Mixes above 4500 PSI typically require higher cement content and higher per-CY cost.</span></span></label>
                                <select id="slabPsi" onchange="handlePsiChange()">
                                    <option value="2500">2500</option><option value="3000" selected>3000</option>
                                    <option value="3500">3500</option><option value="4000">4000</option>
                                    <option value="4500">4500</option><option value="5000">5000</option>
                                    <option value="6000">6000</option>
                                </select>
                            </div>
                            <div class="input-group mb-0"><label>Unit Cost</label><div class="input-adornment"><input type="number" id="costConcrete" value="170" oninput="calculate()"><span>$/CY</span></div></div>
                        </div>
                        <div class="grid grid-cols-2 gap-2 mb-3">
                            <label class="flex items-center gap-2 p-2 rounded-lg border border-slate-100 cursor-pointer bg-slate-50/50">
                                <input type="checkbox" id="fiberMesh" onchange="calculate()" class="w-4 h-4 rounded text-blue-600">
                                <span class="text-[10px] font-bold text-slate-600 uppercase">Fiber Mesh <span class="tooltip"><span class="info-icon !ml-1">i</span><span class="tooltip-content">Reduces plastic shrinkage. Factored as a material adder of $15/CY.</span></span></span>
                            </label>
                            <label class="flex items-center gap-2 p-2 rounded-lg border border-slate-100 cursor-pointer bg-slate-50/50">
                                <input type="checkbox" id="curvedForms" onchange="calculate()" class="w-4 h-4 rounded text-blue-600">
                                <span class="text-[10px] font-bold text-slate-600 uppercase">Curves <span class="tooltip"><span class="info-icon !ml-1">i</span><span class="tooltip-content">Adds $2.80/LF for bender board material.</span></span></span>
                            </label>
                            <label class="flex items-center gap-2 p-2 rounded-lg border border-slate-100 cursor-pointer bg-slate-50/50">
                                <input type="checkbox" id="pumpRequired" onchange="calculate()" class="w-4 h-4 rounded text-blue-600">
                                <span class="text-[10px] font-bold text-slate-600 uppercase">Pump Req. <span class="tooltip"><span class="info-icon !ml-1">i</span><span class="tooltip-content">Adds $1,000 flat fee for line-pump rental and operator.</span></span></span>
                            </label>
                            <label class="flex items-center gap-2 p-2 rounded-lg border border-slate-100 cursor-pointer bg-slate-50/50">
                                <input type="checkbox" id="vaporBarrier" onchange="calculate()" class="w-4 h-4 rounded text-blue-600">
                                <span class="text-[10px] font-bold text-slate-600 uppercase">Vapor Bar. <span class="tooltip"><span class="info-icon !ml-1">i</span><span class="tooltip-content">Adds 0.01 HR/SF for installation labor and material cost.</span></span></span>
                            </label>
                        </div>
                    </div>

                    <details class="group">
                        <summary class="flex items-center justify-between cursor-pointer text-blue-600 font-bold uppercase text-[10px] tracking-widest py-2 hover:bg-blue-50 rounded px-1 transition-colors">
                            <span>Advanced Logic Overrides</span>
                            <svg class="w-3 h-3 transform group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                        </summary>
                        <div class="grid grid-cols-2 gap-x-3 gap-y-3 pt-4 border-t mt-1">
                            <div class="input-group mb-0"><label>Waste % <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Standard 10% volume adder.</span></span></label><input type="number" id="wasteFactor" placeholder="10%" oninput="calculate()"></div>
                            <div class="input-group mb-0"><label>Env./Fuel Fee <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Flat CA state fee per 9CY load.</span></span></label><input type="number" id="costEnvFee" placeholder="$50" oninput="calculate()"></div>
                            <div class="input-group mb-0"><label>Short Load <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Penalty for ordering under 7 CY.</span></span></label><input type="number" id="costShortLoad" placeholder="$250" oninput="calculate()"></div>
                            <div class="input-group mb-0"><label>Base $/CY <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Delivered cost for Class 2 Aggregate base.</span></span></label><input type="number" id="costBaseMaterial" placeholder="$38" oninput="calculate()"></div>
                        </div>
                    </details>
                </div>
            </div>

            <!-- STEP 3: PREP & FINISHING -->
            <div class="card border-t-4 border-orange-500">
                <h2 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-6 border-b pb-2">3. Prep & Finishing</h2>
                <div class="space-y-4">
                    <div class="flex flex-col gap-2 p-3 bg-orange-50 border border-orange-100 rounded-lg">
                        <div class="grid grid-cols-2 gap-2">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="demoRequired" onchange="calculate()" class="w-4 h-4 text-orange-600">
                                <span class="text-[10px] font-black text-orange-800 uppercase">Demo Exist. <span class="tooltip"><span class="info-icon !bg-orange-300">i</span><span class="tooltip-content">Calculated at 0.14 HR/SF. Includes perimeter sawcut and jackhammer break.</span></span></span>
                            </label>
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="haulRequired" onchange="calculate()" class="w-4 h-4 text-orange-600">
                                <span class="text-[10px] font-black text-orange-800 uppercase">Haul Spoils <span class="tooltip"><span class="info-icon !bg-orange-300">i</span><span class="tooltip-content">Hauling labor is 0.50 HR/CY (Standard) or 1.20 HR/CY (Wheelbarrow).</span></span></span>
                            </label>
                        </div>
                        <div class="pt-2 border-t border-orange-100">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="wheelPour" onchange="calculate()" class="w-4 h-4 text-blue-600">
                                <span class="text-[10px] font-black text-blue-600 uppercase italic">Wheelbarrow Mode <span class="tooltip"><span class="info-icon !bg-blue-300">i</span><span class="tooltip-content">Switches placement labor to 2.50 HR/CY and hauling to 1.20 HR/CY.</span></span></span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label>Finishing Style <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Combines Screed (0.02), Bull Float (0.01), Edge (0.10 LF), and Trowel (0.02) factors.</span></span></label>
                        <select id="finishingStyle" onchange="calculate()">
                            <option value="broom">Standard Broom Finish</option>
                            <option value="salt">Salt Finish (Traditional)</option>
                            <option value="sand">Sand Finish / Top-Cast</option>
                            <option value="stamped">Stamped Concrete Pattern</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label>Rentals & Equipment <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Flat-fee material adder for items like compactors or trailers.</span></span></label>
                        <div class="input-adornment"><input type="number" id="costEquip" value="0" oninput="calculate()" placeholder="0.00"><span>$ Total</span></div>
                    </div>

                    <div class="grid grid-cols-2 gap-4 border-t border-slate-50 pt-2">
                        <div class="input-group mb-0">
                            <label class="flex justify-between items-center">
                                <span>Difficulty <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Shift of 0.1 adds 1.0 Man-Hour to the project total.</span></span></span>
                                <span id="diffVal" class="text-blue-600 font-bold bg-blue-50 px-2 rounded">0.0x</span>
                            </label>
                            <input type="range" id="difficultyFactor" min="0" max="2" step="0.1" value="0.0" oninput="calculate()" class="mt-2">
                        </div>
                        <div class="input-group mb-0">
                            <label>Base Labor Rate <span class="tooltip"><span class="info-icon">i</span><span class="tooltip-content">Standard burdened hourly rate including insurance and taxes.</span></span></label>
                            <div class="input-adornment"><input type="number" id="laborRate" value="45" oninput="calculate()"><span>$/HR</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BOTTOM ROW: AUDIT & FINAL OUTPUTS -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-12">
            <!-- PROJECT SUMMARY -->
            <div class="lg:col-span-1">
                <div class="card border-l-4 border-slate-800">
                    <h2 class="text-xs font-black text-slate-400 uppercase tracking-[0.2em] mb-6 border-b pb-2">Project Summary</h2>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <p class="text-[9px] font-bold text-slate-400 uppercase">Surface Area <span class="tooltip"><span class="info-icon !w-3 !h-3 !text-[7px]">i</span><span class="tooltip-content">Factors into all SF-based labor (Excavation, Base, Finish).</span></span></p>
                                <p id="outArea" class="text-lg font-black text-slate-800">--</p>
                            </div>
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <p class="text-[9px] font-bold text-slate-400 uppercase">Concrete Vol. <span class="tooltip"><span class="info-icon !w-3 !h-3 !text-[7px]">i</span><span class="tooltip-content">Calculated with 10% waste. Factors into Placement labor.</span></span></p>
                                <p id="outVolumeWaste" class="text-lg font-black text-slate-800">--</p>
                            </div>
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <p class="text-[9px] font-bold text-slate-400 uppercase">Rebar Needed <span class="tooltip"><span class="info-icon !w-3 !h-3 !text-[7px]">i</span><span class="tooltip-content">Total linear feet of rebar based on grid spacing.</span></span></p>
                                <p id="outRebarLf" class="text-lg font-black text-slate-800">--</p>
                            </div>
                            <div class="p-3 bg-slate-50 rounded-lg">
                                <p class="text-[9px] font-bold text-slate-400 uppercase">Perimeter LF <span class="tooltip"><span class="info-icon !w-3 !h-3 !text-[7px]">i</span><span class="tooltip-content">Factors into all LF-based labor (Forming, Edging, Stripping).</span></span></p>
                                <p id="outPerimeter" class="text-lg font-black text-slate-800">--</p>
                            </div>
                        </div>
                        <div class="p-4 bg-blue-50 rounded-lg border border-blue-100 flex justify-between items-center">
                            <div>
                                <p class="text-[10px] font-black text-blue-400 uppercase tracking-widest">Total Man Hours <span class="tooltip"><span class="info-icon !bg-blue-300">i</span><span class="tooltip-content">Aggregated man-hours from Logistics, Prep, Forms, Pour, Finish, Cleanup, and Difficulty.</span></span></p>
                                <p id="outTotalLaborHours" class="text-2xl font-black text-blue-700">--</p>
                            </div>
                            <p id="outFinishLabel" class="text-[10px] font-bold text-blue-800 bg-white px-3 py-1 rounded-full shadow-sm">--</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NEGOTIATION CHECK -->
            <div class="lg:col-span-1">
                <div class="card bg-blue-50 border border-blue-100">
                    <h2 class="text-xs font-black text-blue-400 uppercase tracking-[0.2em] mb-6 border-b border-blue-100 pb-2">Negotiation Check</h2>
                    <div class="space-y-4">
                        <div class="input-group">
                            <label class="!text-blue-700">Contractor Quote Received</label>
                            <div class="input-adornment"><input type="number" id="contractorBid" placeholder="0.00" oninput="calculate()" class="bg-white border-blue-200 font-bold"><span>$</span></div>
                        </div>
                        <div class="flex items-center justify-between py-1 border-t border-blue-100 pt-3">
                            <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Target Bid (inc. Markup)</p>
                            <p id="outShouldPayBid" class="text-xl font-black text-slate-900">$0</p>
                        </div>
                        <div id="varianceBox" class="text-center py-2 rounded-lg bg-white border border-blue-100">
                            <p class="text-[9px] font-bold text-slate-400 uppercase">Market Variance</p>
                            <p id="outBidVariance" class="text-xl font-black tracking-tight text-slate-700">--</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FINAL ESTIMATES -->
            <div class="lg:col-span-1">
                <div class="card bg-slate-900 text-white border-none shadow-2xl">
                    <h2 class="text-xs font-black text-slate-500 uppercase tracking-[0.2em] mb-10 border-b border-slate-800 pb-2">Final Estimates</h2>
                    <div class="space-y-8">
                        <div class="flex justify-between items-center">
                            <p class="text-[11px] font-bold text-slate-400 uppercase tracking-widest">Materials/Equip</p>
                            <p id="outTotalMaterial" class="!text-white text-xl font-bold">--</p>
                        </div>
                        <div class="flex justify-between items-center">
                            <p class="text-[11px] font-bold text-slate-400 uppercase tracking-widest">Labor Subtotal</p>
                            <p id="outTotalLabor" class="!text-white text-xl font-bold">--</p>
                        </div>
                        <div class="pt-8 border-t border-slate-800 mt-10 flex justify-between items-center">
                            <p class="text-[11px] font-black text-white uppercase tracking-[0.2em]">Net Project Cost</p>
                            <p id="outGrandTotal" class="!text-green-400 text-xl font-black">--</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- REFERENCE INDEX -->
        <div class="mb-12">
            <details class="group bg-white rounded-xl border border-slate-200 shadow-sm transition-all">
                <summary class="flex items-center justify-between p-4 cursor-pointer hover:bg-slate-50">
                    <h3 class="font-black text-slate-800 uppercase text-xs tracking-widest">Reference Index: Calculation Assumptions</h3>
                    <svg class="w-5 h-5 text-slate-400 group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </summary>
                <div class="p-6 border-t border-slate-100 bg-white grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <div>
                        <h4 class="text-[10px] font-black text-blue-600 uppercase mb-4 tracking-widest">Core Unit Costs</h4>
                        <table class="w-full text-[11px]">
                            <tbody class="divide-y divide-slate-100">
                                <tr class="py-1"><td>Concrete (3k)</td><td class="text-right font-bold">$170 / CY</td></tr>
                                <tr class="py-1"><td>Concrete (6k)</td><td class="text-right font-bold">$265 / CY</td></tr>
                                <tr class="py-1"><td>Base (Class 2)</td><td class="text-right font-bold">$38 / CY</td></tr>
                                <tr class="py-1"><td>Rebar (#4)</td><td class="text-right font-bold">$0.68 / LF</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                        <h4 class="text-[10px] font-black text-orange-600 uppercase mb-4 tracking-widest">Labor (Man-Hrs/Unit)</h4>
                        <table class="w-full text-[11px]">
                            <tbody class="divide-y divide-slate-100">
                                <tr class="py-1"><td>Manual Excavation</td><td class="text-right font-bold">0.05 / SF</td></tr>
                                <tr class="py-1"><td>Formwork Setup</td><td class="text-right font-bold">0.20 / LF</td></tr>
                                <tr class="py-1"><td>Truck Placement</td><td class="text-right font-bold">0.75 / CY</td></tr>
                                <tr class="py-1"><td>Hauling (Standard)</td><td class="text-right font-bold">0.50 / CY</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                        <h4 class="text-[10px] font-black text-slate-900 uppercase mb-4 tracking-widest">Logistics</h4>
                        <table class="w-full text-[11px]">
                            <tbody class="divide-y divide-slate-100">
                                <tr class="py-1"><td>Pump Fee</td><td class="text-right font-bold">$1,000 Flat</td></tr>
                                <tr class="py-1"><td>Wait for Bleed</td><td class="text-right font-bold">1.0 Hr (LS)</td></tr>
                                <tr class="py-1"><td>Fixed Markup</td><td class="text-right font-bold">20% Total</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </details>
        </div>
    </div>

    <script>
        const REBAR_PRICE = { "#3": 0.42, "#4": 0.68, "#5": 1.10 };
        const PSI_DEFAULTS = { "2500": 160, "3000": 170, "3500": 178, "4000": 188, "4500": 205, "5000": 225, "6000": 265 };
        const MARKET_STANDARDS = { wasteFactor: 10, costEnvFee: 50, costShortLoad: 250, costBaseMaterial: 38, markupPercent: 20, costDemoSF: 2.50, costHaulCY: 65.00 };
        const FINISH_LOGIC = { broom: { label: "Broom", multi: 1.0 }, salt: { label: "Salt", multi: 1.25 }, sand: { label: "Sand", multi: 1.6 }, stamped: { label: "Stamped", multi: 2.2 } };

        function safeSet(id, value) { const el = document.getElementById(id); if (el) el.textContent = value; }
        function handlePsiChange() { const val = PSI_DEFAULTS[document.getElementById('slabPsi').value] || 170; document.getElementById('costConcrete').value = val; calculate(); }

        function calculate() {
            const getVal = (id) => parseFloat(document.getElementById(id)?.value) || 0;
            const isCheck = (id) => document.getElementById(id)?.checked || false;

            const getOverride = (id, stdKey) => {
                const el = document.getElementById(id);
                if (!el || el.value === "") return MARKET_STANDARDS[stdKey];
                return parseFloat(el.value);
            };

            const LFt = getVal('lengthFt'), LIn = getVal('lengthIn'), WFt = getVal('widthFt'), WIn = getVal('widthIn');
            const L = LFt + (LIn / 12), W = WFt + (WIn / 12);
            const thickIn = getVal('thickness'), baseIn = getVal('baseThickness'), aboveIn = getVal('aboveGrade');
            const netExcavationIn = Math.max(0, (thickIn + baseIn) - aboveIn);
            const area = L * W, perimeter = (L + W) * 2;
            const rate = getVal('laborRate');

            // Difficulty logic
            const diffFactor = parseFloat(document.getElementById('difficultyFactor').value) || 0.0;
            document.getElementById('diffVal').textContent = diffFactor.toFixed(1) + 'x';
            const additiveHrs = diffFactor * 10;

            const waste = getOverride('wasteFactor', 'wasteFactor');
            const envFee = getOverride('costEnvFee', 'costEnvFee');
            const shortLoad = getOverride('costShortLoad', 'costShortLoad');
            const basePrice = getOverride('costBaseMaterial', 'costBaseMaterial');

            const volCY = (area * (thickIn / 12)) / 27;
            const volWasteCY = volCY * (1 + (waste / 100));
            const baseCY = (area * (baseIn / 12)) / 27;
            const haulCY = (area * (netExcavationIn / 12)) / 27;

            const rsFt = 1.5;
            const rebarLF = ((Math.floor(L / rsFt) + 1) * W + (Math.floor(W / rsFt) + 1) * L);
            const finish = FINISH_LOGIC[document.getElementById('finishingStyle').value] || FINISH_LOGIC.broom;

            // --- LABOR CALCULATION ---
            const linearHrs = perimeter * (0.05 + 0.20 + 0.05 + 0.10 + 0.05); // Layout, Form, Exp, Edge, Strip
            let areaRate = (0.05 + 0.01 + 0.03 + 0.02 + 0.02 + 0.01 + 0.02); // Exc, Comp, Base, Rebar, Screed, Float, Trowel
            if (isCheck('vaporBarrier')) areaRate += 0.01;
            const areaHrs = area * areaRate * finish.multi;

            const placeRate = isCheck('wheelPour') ? 2.50 : 0.75;
            const haulRate = isCheck('wheelPour') ? 1.20 : 0.50;
            const placementHrs = volWasteCY * placeRate;
            const haulLaborHrs = isCheck('haulRequired') ? (haulCY * haulRate) : 0;
            const demoHrs = isCheck('demoRequired') ? (area * 0.14) : 0;

            const totalLaborHrs = linearHrs + areaHrs + placementHrs + haulLaborHrs + demoHrs + 4.0 + additiveHrs;
            const laborCost = totalLaborHrs * rate;

            // --- MATERIAL & EQUIPMENT ---
            const equipCost = getVal('costEquip');
            const pumpFee = isCheck('pumpRequired') ? 1000 : 0;
            const envTotal = envFee * Math.ceil(volWasteCY / 9);
            const shortTotal = volWasteCY < 7 ? shortLoad : 0;

            const concreteMat = volWasteCY * (getVal('costConcrete') + (isCheck('fiberMesh') ? 15 : 0));
            const rebarCost = rebarLF * (REBAR_PRICE[document.getElementById('rebarSize').value] || 0.68);
            const baseCost = baseCY * basePrice;
            
            const matSubtotal = concreteMat + baseCost + rebarCost + envTotal + shortTotal + equipCost + pumpFee;
            const prepMaterial = (isCheck('demoRequired') ? area * 2.5 : 0) + (isCheck('haulRequired') ? haulCY * 65 : 0);
            
            const totalMaterialEquip = matSubtotal + prepMaterial;
            const grandTotal = totalMaterialEquip + laborCost;
            const shouldPay = grandTotal * 1.20;

            safeSet('excavationHelperValue', `${netExcavationIn.toFixed(1)}"` );
            safeSet('outArea', `${area.toFixed(0)} SF`);
            safeSet('outPerimeter', `${perimeter.toFixed(0)} LF`);
            safeSet('outVolumeWaste', `${volWasteCY.toFixed(1)} CY`);
            safeSet('outTotalLaborHours', `${totalLaborHrs.toFixed(1)} Hrs`);
            safeSet('outRebarLf', `${rebarLF.toFixed(0)} LF`);
            safeSet('outFinishLabel', finish.label);
            safeSet('outTotalMaterial', `$${totalMaterialEquip.toLocaleString(undefined, {minimumFractionDigits:2})}`);
            safeSet('outTotalLabor', `$${laborCost.toLocaleString(undefined, {minimumFractionDigits:2})}`);
            safeSet('outGrandTotal', `$${grandTotal.toLocaleString(undefined, {minimumFractionDigits:2})}`);
            safeSet('outShouldPayBid', `$${shouldPay.toLocaleString(undefined, {maximumFractionDigits:0})}`);

            const bid = getVal('contractorBid');
            if (bid > 0) {
                const diff = bid - shouldPay;
                safeSet('outBidVariance', `${((diff/shouldPay)*100).toFixed(1)}%`);
                document.getElementById('outBidVariance').style.color = diff > 0 ? '#ef4444' : '#22c55e';
            }
        }
        window.onload = () => { calculate(); };
    </script>
</body>
</html>

